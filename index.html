<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kredit Syariah Sangatta (KSS)</title>
  <meta name="description" content="Kredit Syariah Sangatta dengan prinsip transparansi, tanpa riba, dan cicilan ringan.">

</head>
<body>

  <!-- Info Awal -->
  <div class="info-box">
    <h2>(KSS) Kredit Syariah Sangatta</h2>
    <p>Kredit syariah dengan akad Murabahan: transaksi transparan, pembeli dan penjual saling mengetahui harga modal dan keuntungan.</p>
    <ul>
      <li>Akad jual beli</li>
      <li>Harga tetap dari awal</li>
      <li>Tanpa riba bunga</li>
      <li>Penyerahan berupa barang, bukan uang</li>
    </ul>
  </div>

  <!-- Simulasi Cicilan -->
  <div class="container">
    <h2>Simulasi Cicilan</h2>
    <label for="hargaBarang">Harga Barang:</label>
    <input type="number" id="hargaBarang" placeholder="Contoh: 10000000">

    <label for="lamaCicilan">Lama Cicilan (bulan):</label>
    <input type="number" id="lamaCicilan" placeholder="Contoh: 10">

    <label for="dp">DP (opsional):</label>
    <input type="number" id="dp" placeholder="Contoh: 1000000">

    <button onclick="hitungCicilan()">Hitung Cicilan</button>
    <div id="hasilCicilan"></div>
  </div>

  <!-- Langkah & Skema -->
  <div class="steps">
    <h3>Langkah Pengajuan Kredit</h3>
    <ol>
      <li>Chat Admin</li>
      <li>Tentukan salah satu skema pembelian</li>
    </ol>
  </div>

  <div class="steps">
    <h3>Skema Pembelian</h3>
    <ol>
      <li>Cara Pertama: Beritahu kami barang, toko, dan harga â†’ kami beli lalu jual ke Anda.</li>
      <li>Cara Kedua: Anda bersama kami ke toko â†’ kami beli & jual ke Anda.</li>
      <li>Cara Ketiga: Kami carikan barang â†’ buat kesepakatan â†’ beli & jual ke Anda.</li>
      <li>Cara Keempat: Anda survei ke toko â†’ kami transfer â†’ beli & jual ke Anda.</li>
    </ol>
  </div>

  <div class="steps">
    <h3>Kemudahan yang Didapat</h3>
    <ul>
      <li>Boleh tanpa DP / Uang muka</li>
      <li>DP meringankan cicilan</li>
      <li>DP wajib jika disyaratkan tim survei</li>
    </ul>
  </div>

  <div class="steps">
    <h3>Syarat Pengajuan Kredit</h3>
    <ol>
      <li>Amanah</li>
      <li>Bisa dihubungi & punya WA aktif</li>
      <li>Domisili di Sangatta atau sekitarnya</li>
      <li>Siap bayar tepat waktu via transfer (BRI/BSI)</li>
      <li>Siap dibuatkan grup WA 2 orang (Pemohon & Admin KSS)</li>
    </ol>
  </div>

  <!-- Cek Data Konsumen -->
  <div class="container">
    <h2>Cek Data Konsumen</h2>
    <label for="kode">Masukkan Kode 8 Digit:</label>
    <input type="text" id="kode" maxlength="8" placeholder="Contoh: 23011188">
    <button onclick="cekData()">Cek Data</button>

    <div id="loading">Memeriksa data...</div>
    <div id="error"></div>

    <div id="hasil" class="data-container">
      <div class="data-section">
        <h3>Detail Konsumen</h3>
        <div id="detailKonsumen"></div>
      </div>
      <div class="data-section">
        <h3>Riwayat Pembayaran</h3>
        <div id="riwayatCicilan"></div>
      </div>
    </div>
  </div>

  <!-- WA Button -->
  <a id="wa-button" href="https://wa.me/6282352680715?text=Assalamualaikum%0ASaya%0ANama%20%3A%20%0ABisakah%20saya%20mendapatkan%20info%20tentang%20kredit.." target="_blank">
    ðŸ’¬ Chat Admin Widiya
  </a>

  <footer>
    <p>Â© 2023 Kredit Syariah Sangatta - Supported by Widiya</p>
  </footer>

  <script>
    function pembulatanRibuan(nilai) {
      return Math.floor(nilai / 1000) * 1000;
    }

    function hitungCicilan() {
      const harga = parseFloat(document.getElementById('hargaBarang').value);
      const lama = parseInt(document.getElementById('lamaCicilan').value);
      const dp = parseFloat(document.getElementById('dp').value) || 0;
      const hasil = document.getElementById('hasilCicilan');

      if (isNaN(harga) || isNaN(lama)) {
        hasil.innerHTML = "Harap isi Harga dan Lama Cicilan.";
        return;
      }

      if (lama > 12) {
        hasil.innerHTML = "<b>Maaf, maksimal cicilan 12 bulan.</b>";
        return;
      }

      let faktor = (lama <= 5) ? 1.10 : 1 + (lama * 0.02);
      const hargaSetelahDP = harga - dp;
      const hargaJualSementara = hargaSetelahDP * faktor;
      const cicilanAwal = hargaJualSementara / lama;
      const cicilanFinal = pembulatanRibuan(cicilanAwal);
      const hargaJualFinal = cicilanFinal * lama;

      const tanggalSekarang = new Date();
      tanggalSekarang.setMonth(tanggalSekarang.getMonth() + lama);
      const opsiTanggal = { month: 'long', year: 'numeric' };
      const batasAkhir = tanggalSekarang.toLocaleDateString('id-ID', opsiTanggal);

      hasil.innerHTML = `
        <p><b>Harga Jual:</b> Rp ${hargaJualFinal.toLocaleString('id-ID')}</p>
        <p><b>Cicilan Bulanan:</b> Rp ${cicilanFinal.toLocaleString('id-ID')}</p>
        <p><b>Batas Akhir Cicilan:</b> ${batasAkhir}</p>
      `;
    }

    async function cekData() {
      const kode = document.getElementById('kode').value.trim();
      const loading = document.getElementById('loading');
      const error = document.getElementById('error');
      const hasil = document.getElementById('hasil');

      error.style.display = 'none';
      hasil.style.display = 'none';

      if (!kode || kode.length !== 8) {
        error.textContent = 'Kode harus 8 digit';
        error.style.display = 'block';
        return;
      }

      loading.style.display = 'block';

      try {
        const url = `https://script.google.com/macros/s/AKfycbz5VJRylw-dvset6w_JhzVkgUZ1zW5viLtJTKDS7hPSgHuRDBu3vYxqBEHu4cqebfxu/exec?kode=${kode}`;
        const response = await fetch(url);

        if (!response.ok) throw new Error('Network error');

        const data = await response.json();
        loading.style.display = 'none';

        if (data.status === 'success') {
          let htmlKonsumen = '';
          for (const [key, value] of Object.entries(data.data)) {
            if (key === 'riwayat') continue;
            htmlKonsumen += `
              <div class="data-item">
                <span class="data-label">${key}: </span>
                <span class="data-value">${value}</span>
              </div>
            `;
          }
          document.getElementById('detailKonsumen').innerHTML = htmlKonsumen;

          let htmlRiwayat = '';
          if (data.riwayat && data.riwayat.length > 0) {
            data.riwayat.forEach(item => {
              htmlRiwayat += `
                <div class="data-item">
                  <span class="data-label">${item.bulan}: </span>
                  <span class="data-value">${item.status} (${item.tanggal})</span>
                </div>
              `;
            });
          } else {
            htmlRiwayat = '<p>Tidak ada riwayat pembayaran</p>';
          }
          document.getElementById('riwayatCicilan').innerHTML = htmlRiwayat;

          hasil.style.display = 'block';
        } else {
          error.textContent = data.message || 'Kode tidak ditemukan.';
          error.style.display = 'block';
        }
      } catch (err) {
        loading.style.display = 'none';
        error.textContent = 'Terjadi kesalahan, coba lagi.';
        error.style.display = 'block';
      }
    }
  </script>
</body>
</html>
